"use strict";const{ipcMain:P,dialog:y,app:g}=require("electron"),s=require("fs"),w=require("path"),I=require("archiver"),{spawn:L}=require("child_process");async function F(i){const a=y.showSaveDialogSync({defaultPath:"recordings.zip",filters:[{name:"ZIP Files",extensions:["zip"]}]});if(a){const m=s.createWriteStream(a),l=I("zip");let r=[];l.pipe(m);for(const b of i){const{name:t,buffer:S}=b,d=w.join(g.getPath("downloads"),`${t}.webm`);s.writeFileSync(d,Buffer.from(S));const p=w.join(g.getPath("downloads"),`${t}.flv`),u=L("ffmpeg",["-i",d,"-c:v","copy","-c:a","aac","-ar",44100,p]);u.on("error",o=>{console.error("Error converting video:",o)}),u.stderr.on("data",o=>{console.error(`ffmpeg stderr: ${o}`)}),u.on("close",async o=>{o===0?(console.log(`Video ${t} converted to FLV successfully.`),l.append(s.createReadStream(p),{name:`${t}.flv`}),r.push({flvFilePath:p,webmFilePath:d}),r.length&&r.length===i.length&&(await l.finalize(),r.map(h=>{s.unlinkSync(h.webmFilePath),s.unlinkSync(h.flvFilePath)}))):console.error(`Video ${t} conversion failed with code: ${o}`)})}}}const D={setDefaultIpcMain(){P.handle("save-data",(i,a)=>{F(a)})}},{app:n,BrowserWindow:E,systemPreferences:f}=require("electron"),c=require("path");process.env.DIST=c.join(__dirname,"../dist");process.env.PUBLIC=n.isPackaged?process.env.DIST:c.join(process.env.DIST,"../public");let e;const v=process.env.VITE_DEV_SERVER_URL;D.setDefaultIpcMain();function q(){e=new E({width:1280,height:780,icon:c.join(process.env.PUBLIC,"vite.svg"),webPreferences:{plugins:!0,contextIsolation:!1,nodeIntegration:!0,webSecurity:!1,devTools:!0}}),e.webContents.once("dom-ready",()=>{process.platform==="darwin"&&f.getMediaAccessStatus("microphone")!=="granted"&&(f.askForMediaAccess("microphone"),f.askForMediaAccess("camera"))}),e.webContents.on("did-finish-load",()=>{e==null||e.webContents.send("main-process-message",new Date().toLocaleString())}),process.env.NODE_ENV=="development"&&e.webContents.openDevTools(),v?e.loadURL(v):e.loadFile(c.join(process.env.DIST,"index.html")),require("@electron/remote/main").enable(e.webContents)}n.on("window-all-closed",()=>{e=null,n.quit()});n.whenReady().then(q);n.commandLine.appendSwitch("disable-features","OutOfBlinkCors");n.commandLine.appendArgument("no-sandbox");n.commandLine.appendArgument("disable-setuid-sandbox");n.commandLine.appendArgument("disable-web-security");n.commandLine.appendArgument("ignore-certificate-errors");n.commandLine.appendSwitch("disable-site-isolation-trials");n.commandLine.appendSwitch("enable-quic");
